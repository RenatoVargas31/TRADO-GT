<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
  <meta charset="utf-8" />
  <title>Muebles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSS BASE -->
  <meta th:replace="~{Common/cssBase :: css_Base}">
  <!-- End CSS BASE -->

  <!-- ION Slider -->
  <link th:href="@{../libs/ion-rangeslider/css/ion.rangeSlider.min.css}" rel="stylesheet" type="text/css"/>

</head>

<body data-sidebar="dark">

<!-- <body data-layout="horizontal" data-topbar="dark"> -->

<!-- Begin page -->
<div id="layout-wrapper">

  <!-- ========== NavBar Start ========== -->
  <header th:replace="~{Usuario/fragments/navbar :: nav_bar}"></header>
  <!-- Navbar End -->
  <!-- ========== Left Sidebar Start ========== -->
  <div th:replace="~{Usuario/fragments/sidebar :: side_bar}"></div>
  <!-- Left Sidebar End -->
  <!-- ============================================================== -->
  <!-- Start right Content here -->
  <!-- ============================================================== -->
  <div class="main-content">
    <div class="page-content">
      <div class="container-fluid">

        <!-- start page title -->
        <div class="row">
          <div class="col-12">
            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
              <h4 class="mb-sm-0">Muebles</h4>

              <div class="page-title-right">
                <ol class="breadcrumb m-0">

                  <li class="breadcrumb-item active">Tienda</li>
                  <li class="breadcrumb-item"><a href="javascript: void(0);">Muebles</a></li>
                </ol>
              </div>

            </div>
          </div>
        </div>
        <!-- end page title -->


        <!-- Subcategorías -->
        <div class="row">
          <div class="card" style="height:130px">
            <div class="card-body">
              <div class="container">
                <!-- Subcategorias -->
                <div class="row flex-nowrap overflow-auto justify-content-start justify-content-md-center" style="gap: 10px;">
                  <div class="col-6 col-sm-4 col-md-3 col-lg-2 text-center flex-shrink-0">
                    <a th:href="@{/usuario/categoriaMueblesFilter?categoria=16}">
                      <img class="rounded-circle avatar-md img-fluid" alt="Comedores" th:src="@{../images/mueblesHogar/comedor.jpeg}"
                           style="transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; display: inline-block; transform-origin: center;"
                           onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.2)';"
                           onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                    </a>
                    <div class="mt-2">
                      <p>Juego de Comedor</p>
                    </div>
                  </div>
                  <div class="col-6 col-sm-4 col-md-3 col-lg-2 text-center flex-shrink-0">
                    <a th:href="@{/usuario/categoriaMueblesFilter?categoria=17}">
                      <img class="rounded-circle avatar-md img-fluid" alt="Sillones" th:src="@{../images/mueblesHogar/sillon.jpeg}"
                           style="transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; display: inline-block; transform-origin: center;"
                           onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.2)';"
                           onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                    </a>
                    <div class="mt-2">
                      <p>Sillones</p>
                    </div>
                  </div>
                  <div class="col-6 col-sm-4 col-md-3 col-lg-2 text-center flex-shrink-0">
                    <a th:href="@{/usuario/categoriaMueblesFilter?categoria=18}">
                      <img class="rounded-circle avatar-md img-fluid" alt="Armarios" th:src="@{../images/mueblesHogar/armario.jpeg}"
                           style="transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; display: inline-block; transform-origin: center;"
                           onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.2)';"
                           onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                    </a>
                    <div class="mt-2">
                      <p>Armarios</p>
                    </div>
                  </div>
                  <div class="col-6 col-sm-4 col-md-3 col-lg-2 text-center flex-shrink-0">
                    <a th:href="@{/usuario/categoriaMueblesFilter?categoria=19}">
                      <img class="rounded-circle avatar-md img-fluid" alt="Literas" th:src="@{../images/mueblesHogar/Literas.jpeg}"
                           style="transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; display: inline-block; transform-origin: center;"
                           onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.2)';"
                           onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                    </a>
                    <div class="mt-2">
                      <p>Literas</p>
                    </div>
                  </div>
                  <div class="col-6 col-sm-4 col-md-3 col-lg-2 text-center flex-shrink-0">
                    <a th:href="@{/usuario/categoriaMueblesFilter?categoria=20}">
                      <img class="rounded-circle avatar-md img-fluid" alt="Estantes" th:src="@{../images/mueblesHogar/Estante.jpeg}"
                           style="transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; display: inline-block; transform-origin: center;"
                           onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.2)';"
                           onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                    </a>
                    <div class="mt-2">
                      <p>Estantes</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <!-- Filtros -->
          <div class="col-lg-3">
            <div class="row mb-3">
              <div class="col">
                <div class="card" style="max-height: 650px; overflow-y: auto;">
                  <div class="card-header bg-transparent border-bottom">
                    <h5 class="mb-0 fw-bolder ">Filtros</h5>
                  </div>
                  <div class="custom-accordion">
                    <form action="/usuario/categoriaMueblesFilter" method="GET" id="filterForm">
                      <div class="card-body border-top">
                        <div>
                          <h5 class="font-size-14 mb-0">
                            <a href="#collapseExample1" class="text-reset d-block" data-bs-toggle="collapse">Categorías <i class="mdi mdi-plus float-end accor-plus-icon"></i></a>
                          </h5>
                          <div class="collapse" id="collapseExample1">
                            <div class="mt-4">
                              <div th:each="categoria : ${categoriasList}" class="form-check mt-2">
                                <input type="checkbox"
                                       th:id="'categoria' + ${categoria.id}"
                                       th:name="'categoria'"
                                       th:value="${categoria.id}"
                                       class="form-check-input"
                                       th:checked="${param.categoria != null && param.categoria.contains(categoria.id.toString())}" />


                                <label class="form-check-label"
                                       th:for="'categoria' + ${categoria.id}"
                                       th:text="${categoria.nombre}">Categoria</label>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="card-body border-top">
                        <div>
                          <h5 class="font-size-14 mb-0">
                            <a href="#collapseExample5" class="text-reset d-block" data-bs-toggle="collapse" aria-expanded="false" aria-controls="collapseExample5">
                              Material <i class="mdi mdi-plus float-end accor-plus-icon"></i>
                            </a>
                          </h5>
                          <div class="collapse" id="collapseExample5">
                            <div class="mt-4">
                              <div th:each="material, iterStat : ${materialesList}" class="form-check mt-2">
                                <input type="checkbox"
                                       th:id="'material_' + ${iterStat}"
                                       name="material"
                                       class="form-check-input"
                                       th:value="${material.toLowerCase()}"
                                       th:checked="${param.material != null && param.material.contains(material.toLowerCase())}"/>
                                <label class="form-check-label" th:for="'material_' + ${iterStat}" th:text="${material}"></label>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="card-body border-top">
                        <div>
                          <h5 class="font-size-14 mb-0">
                            <a href="#collapseExample7" class="text-reset d-block" data-bs-toggle="collapse" aria-expanded="false" aria-controls="collapseExample5">
                              Marca <i class="mdi mdi-plus float-end accor-plus-icon"></i>
                            </a>
                          </h5>
                          <div class="collapse" id="collapseExample7">
                            <div class="mt-4">
                              <div th:each="marca, iterStat : ${marcaList}" class="form-check mt-2">
                                <input type="checkbox"
                                       th:id="'marca' + ${iterStat}"
                                       name="marca"
                                       class="form-check-input"
                                       th:value="${marca.toLowerCase()}"
                                       th:checked="${param.marca != null && param.marca.contains(marca.toLowerCase())}"/>
                                <label class="form-check-label" th:for="'marca' + ${iterStat}" th:text="${marca}"></label>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="card-body border-top">
                        <div>
                          <h5 class="font-size-14 mb-0">
                            <a href="#collapseExample3" class="text-reset d-block" data-bs-toggle="collapse">Precio <i class="mdi mdi-plus float-end accor-plus-icon"></i></a>
                          </h5>
                          <div class="collapse" id="collapseExample3">
                            <div class="mt-4">
                              <div class="form-group">
                                <label for="precioMin" class="form-label">Precio Mínimo</label>
                                <input type="number" id="precioMin" name="precioMin" class="form-control" placeholder="Ingrese precio mínimo" min="0">
                              </div>
                              <hr class="opacity-0">
                              <div class="form-group">
                                <label for="precioMax" class="form-label">Precio Máximo</label>
                                <input type="number" id="precioMax" name="precioMax" class="form-control" placeholder="Ingrese precio máximo" min="0">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="text-center">
                        <a href="/usuario/categoriaMueblesFilter" class="btn btn-secondary mt-3 me-2 btn-sm">Limpiar</a>
                        <button type="submit" class="btn btn-primary mt-3 btn-sm">Filtrar</button>
                      </div>
                      <br>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <div class="card" style="max-height: 250px; overflow-y: auto;">
                  <div class="card-body">
                    <p>Holaaa
                      :D </p>

                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Catálogo -->
          <div class="col-lg-9">
            <div class="card" style="max-height: 1050px; overflow-y: auto; min-height: 500px" >
              <div class="card-body">
                <div  class="container">
                  <!-- Buscador -->
                  <div class="row">
                    <div class="col-md-6">
                      <h5 class="fw-bold">Muebles</h5>
                    </div>
                    <div class="col-md-6 d-flex justify-content-end">
                      <form class="d-flex" action="/usuario/categoriaMueblesSearch" method="GET">
                        <div class="search-box me-2">
                          <div class="position-relative">
                            <input type="text" name="query" class="form-control form-control-sm rounded-pill ps-5" placeholder="Buscar...">
                            <i class="mdi mdi-magnify search-icon position-absolute top-50 start-0 translate-middle-y ms-3"></i>
                          </div>
                        </div>
                        <div class="form-inline me-2">
                          <button type="submit" class="btn btn-primary waves-effect waves-light btn-sm">Buscar</button>
                          <a href="/usuario/categoriaMueblesFilter" class="btn btn-secondary me-2 btn-sm">Limpiar</a>
                        </div>
                      </form>
                    </div>
                  </div>
                  <hr>

                  <!-- Cards -->
                  <div id="product-list" class="row g-0">
                    <strong th:text="'Resultados: '+${productList.size()}"></strong>
                    <div th:if="${productList == null or #lists.isEmpty(productList)}" class="alert alert-warning text-center mt-2">
                      No hay productos disponibles
                    </div>
                    <div th:each="product, iterStat : ${productList}" class="col-xl-3 col-sm-4 mt-2">
                      <div class="card product-box"  style="max-height: 340px; height: 340px">
                        <a th:href="@{'/usuario/productoDetalles?id=' + ${product.id}}" class="text-decoration-none">
                          <div class="product-img">
                            <div class="product-ribbon badge bg-warning">
                              <span th:text="${product.codigo}"></span>
                            </div>
                          </div>
                          <div class="card-img">
                            <img th:src="@{'/usuario/productoFoto/' + ${product.id}}"
                                 src="/images/error.jpg"
                                 onerror="this.onerror=null;this.src='/images/error.jpg';"
                                 alt="producto-img"
                                 class="img-fluid mx-auto d-block" style="width: 250px; max-height: 160px; object-fit: cover;height: 160px;">
                          </div>
                          <div class="text-center mt-3">
                            <p class="font-size-12 mb-1 text-primary">
                              <span th:text="${product.subcategoriaIdsubcategoria.nombre}">Categoría, Subcategoría</span>
                            </p>
                            <h5 class="font-size-15">
                              <a th:text="${#strings.capitalize(product.nombre)}" class="text-reset">Product Name</a>
                            </h5>
                            <!-- Banner del corazón (like) en la esquina superior derecha
                            <div class="product-like" th:if="${product.isFavorite == 1}">
                              <div class="product-ribbon badge" style="position: absolute; top: 10px; right: 10px; color: red">
                                <div class="btn btn-danger "
                                     style="border-radius: 50%; padding: 10px; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center;">
                                  <i class="mdi mdi-heart-outline" style="font-size: 24px;"></i>
                                </div>
                              </div>
                            </div>-->
                            <h5 class="mt-2" style="font-size: 14px;">
                              S/ <span th:text="${product.precio}">100</span>
                              <span style="font-size: 12px; color: #888;">por unidad</span>
                            </h5>
                          </div>
                          <div class="provider-info d-flex align-items-center justify-content-center" style="margin-top: auto;">
                            <img th:src="@{/usuario/proveedorImagen/{id}(id=${product.proveedorIdproveedor.id})}"
                                 src="/images/product/iconoProvedor.png"
                                 onerror="this.onerror=null;this.src='/images/product/iconoProvedor.png';"
                                 alt="Proveedor Icono" class="rounded-circle me-2" style="width: 25px; height: 25px;">
                            <span th:text="${product.proveedorIdproveedor.tienda}" class="provider-name small">Nombre del proveedor</span>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <!-- Paginación -->
                <div class="row mt-4">
                  <div class="col-sm-6">
                    <div>
                      <p class="mb-sm-0 mt-2">Página <span id="current-page" class="fw-bold">1</span> de <span id="total-pages" class="fw-bold">1</span></p>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="float-sm-end">
                      <ul id="pagination" class="pagination pagination-rounded mb-sm-0">
                        <li class="page-item" id="prev-page"><a class="page-link"><i class="mdi mdi-chevron-left"></i></a></li>
                        <li class="page-item active"><a class="page-link" id="current-page-num">1</a></li>
                        <li class="page-item" id="next-page"><a class="page-link"><i class="mdi mdi-chevron-right"></i></a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->
    <footer class="footer">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-6">
            <script>document.write(new Date().getFullYear())</script> © TRADO.
          </div>
          <div class="col-sm-6">
            <div class="text-sm-end d-none d-sm-block">
              Crafted with <i class="mdi mdi-heart text-danger"></i> by TelesoftGT
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- end main content-->
</div>
<!-- END layout-wrapper -->


<!-- JAVASCRIPT BASE-->
<span th:replace="~{Common/jsBase :: js_Base}"></span>

<!--JAVASCRIPT NOTIFICACIONES-->
<span th:replace="~{Usuario/fragments/notificaciones-scripts :: js_Notificaciones}"></span>
<!-- End JAVASCRIPT NOTIFICACIONES-->

<!-- Ion Range Slider-->
<script th:src="@{../libs/ion-rangeslider/js/ion.rangeSlider.min.js}"></script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const itemsPerPage = 9; // 3 filas de 3 productos cada una
    let currentPage = 1;

    const productCards = document.querySelectorAll('.product-box');
    const totalItems = productCards.length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);

    const paginationElement = document.getElementById('pagination');
    const currentPageElement = document.getElementById('current-page');
    const totalPagesElement = document.getElementById('total-pages');

    totalPagesElement.textContent = totalPages; // Mostrar el total de páginas

    // Mostrar solo los productos de la página actual
    function showPage(page) {
      currentPage = page;

      // Ocultar todos los productos
      productCards.forEach((card, index) => {
        card.style.display = 'none'; // Ocultar todos los productos
        if (index >= (page - 1) * itemsPerPage && index < page * itemsPerPage) {
          card.style.display = 'block'; // Mostrar productos en la página actual
        }
      });

      // Actualizar el número de página actual
      currentPageElement.textContent = currentPage;
      document.getElementById('current-page-num').textContent = currentPage;

      // Habilitar o deshabilitar los botones "prev" y "next"
      document.getElementById('prev-page').classList.toggle('disabled', currentPage === 1);
      document.getElementById('next-page').classList.toggle('disabled', currentPage === totalPages);
    }

    // Manejar el evento de clic para la paginación
    paginationElement.addEventListener('click', function(event) {
      const pageItem = event.target.closest('li');
      if (pageItem) {
        if (pageItem.id === 'prev-page' && currentPage > 1) {
          showPage(currentPage - 1);
        } else if (pageItem.id === 'next-page' && currentPage < totalPages) {
          showPage(currentPage + 1);
        }
      }
    });

    // Inicializa la primera página
    showPage(currentPage);

    // Filtrar productos por búsqueda
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', function() {
      const searchTerm = searchInput.value.toLowerCase();

      // Filtrar productos
      let visibleItems = 0;
      productCards.forEach(card => {
        const productName = card.querySelector('h5').textContent.toLowerCase();
        const providerName = card.querySelector('.provider-name').textContent.toLowerCase();
        const productCode = card.querySelector('.product-ribbon').textContent.toLowerCase();

        if (productName.includes(searchTerm) || providerName.includes(searchTerm) || productCode.includes(searchTerm)) {
          card.style.display = 'block';
          visibleItems++;
        } else {
          card.style.display = 'none';
        }
      });

      // Actualizar la paginación para los productos filtrados
      const newTotalPages = Math.ceil(visibleItems / itemsPerPage);
      totalPagesElement.textContent = newTotalPages;

      // Si no hay productos visibles, mostrar el mensaje de "No hay productos"
      const noResultsMessage = document.getElementById('no-results-message');
      if (visibleItems === 0) {
        noResultsMessage.style.display = 'block';
      } else {
        noResultsMessage.style.display = 'none';
      }

      showPage(1); // Mostrar la primera página de los resultados filtrados
    });
  });
</script>

<script>
  document.getElementById('filterForm').onsubmit = function(event) {
    event.preventDefault(); // Evitar el envío inmediato del formulario

    const form = this;
    const formData = new FormData(form);
    const params = new URLSearchParams();

    // Agregar solo las categorías seleccionadas
    const categorias = formData.getAll('categoria');
    categorias.forEach(categoria => {
      params.append('categoria', categoria);
    });

    // Agregar solo los materiales seleccionados
    const materiales = formData.getAll('material');
    materiales.forEach(material => {
      params.append('material', material);
    });
    const marcas = formData.getAll('marca');
    marcas.forEach(marca => {
      params.append('marca', marca);
    });

    // Agregar precio mínimo si no está vacío
    const precioMin = formData.get('precioMin').trim();
    if (precioMin) {
      params.append('precioMin', precioMin);
    }

    // Agregar precio máximo si no está vacío
    const precioMax = formData.get('precioMax').trim();
    if (precioMax) {
      params.append('precioMax', precioMax);
    }

    // Redirigir a la URL construida
    const queryString = params.toString();
    const actionUrl = form.action + (queryString ? '?' + queryString : '');

    // Realiza el redireccionamiento
    window.location.href = actionUrl;
  };
</script>


<!-- init js -->
<script th:src="@{../js/pages/product-filter-range.init.js}"></script>
<!-- End JAVASCRIPT BASE-->
</body>

</html>